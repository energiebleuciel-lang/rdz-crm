<!-- ================================================================ -->
<!-- SCRIPT LP TEST - Mode Redirect                                    -->
<!-- LP: LP-TEST-001 | Form: FORM-TEST-001                            -->
<!-- Pour tester sur : votre-landing-page.html                        -->
<!-- ================================================================ -->

<script>
(function() {
  // ========== CONFIGURATION LP ==========
  var CONFIG = {
    API_URL: "https://leadmaster-76.preview.emergentagent.com",
    LP_CODE: "LP-TEST-001",
    FORM_CODE: "FORM-TEST-001",
    FORM_URL: "REMPLACEZ_PAR_URL_DE_VOTRE_FORM",  // Ex: https://monsite.com/formulaire.html
    LIAISON_CODE: "LP-TEST-001_FORM-TEST-001",
    PRODUCT_TYPE: "PV",
    MODE: "redirect"
  };

  // ========== UTM PARAMS ==========
  var urlParams = new URLSearchParams(window.location.search);
  var UTM = {
    source: urlParams.get("utm_source") || "",
    medium: urlParams.get("utm_medium") || "",
    campaign: urlParams.get("utm_campaign") || ""
  };

  // ========== TRACKING LP VIEW ==========
  function trackLPView() {
    console.log("[TEST] Tracking LP View - Code:", CONFIG.LP_CODE);
    
    fetch(CONFIG.API_URL + "/api/track/lp-visit", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        lp_code: CONFIG.LP_CODE,
        referrer: document.referrer
      })
    })
    .then(function(r) { return r.json(); })
    .then(function(data) { 
      console.log("[TEST] LP Visit tracked:", data); 
    })
    .catch(function(e) { 
      console.log("[TEST] LP view error:", e); 
    });
  }

  // ========== TRACKING CTA + REDIRECT ==========
  window.trackCTAClick = function(ctaId, ctaText) {
    console.log("[TEST] CTA Click - Redirecting to form...");
    
    fetch(CONFIG.API_URL + "/api/track/cta-click", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        lp_code: CONFIG.LP_CODE,
        form_code: CONFIG.FORM_CODE
      })
    })
    .then(function(r) { return r.json(); })
    .then(function(data) { 
      console.log("[TEST] CTA Click tracked:", data); 
    })
    .catch(function(e) { 
      console.log("[TEST] CTA click error:", e); 
    });
    
    // Construire URL du form avec paramètres
    var formUrl = CONFIG.FORM_URL;
    var sep = formUrl.indexOf("?") === -1 ? "?" : "&";
    formUrl += sep + "lp=" + CONFIG.LP_CODE + "&liaison=" + CONFIG.LIAISON_CODE;
    
    // Ajouter UTM
    if (UTM.source) formUrl += "&utm_source=" + encodeURIComponent(UTM.source);
    if (UTM.medium) formUrl += "&utm_medium=" + encodeURIComponent(UTM.medium);
    if (UTM.campaign) formUrl += "&utm_campaign=" + encodeURIComponent(UTM.campaign);
    
    console.log("[TEST] Redirecting to:", formUrl);
    
    // Pour le test, on ne redirige pas automatiquement
    // Décommentez la ligne suivante pour activer la redirection
    // window.location.href = formUrl;
    
    alert("Test: Redirection vers " + formUrl);
  };

  // ========== INIT ==========
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", trackLPView);
  } else {
    trackLPView();
  }
  
  console.log("[TEST] Script LP initialisé (redirect)");
  console.log("[TEST] LP:", CONFIG.LP_CODE, "| Form URL:", CONFIG.FORM_URL);
})();
</script>

<!-- ========== EXEMPLE HTML DE TEST ========== -->
<!--
Copiez ce HTML dans votre page de test:

<!DOCTYPE html>
<html>
<head>
  <title>Test LP - Panneaux Solaires</title>
  [COLLEZ LE SCRIPT CI-DESSUS ICI]
</head>
<body>
  <h1>Économisez sur votre facture d'électricité</h1>
  <p>Profitez de l'énergie solaire avec nos panneaux photovoltaïques</p>
  
  <button onclick="trackCTAClick('hero-btn', 'Demander un devis')">
    Demander un devis gratuit
  </button>
  
  <a href="javascript:void(0)" onclick="trackCTAClick('cta-2', 'Estimation')">
    Estimation gratuite →
  </a>
</body>
</html>
-->
